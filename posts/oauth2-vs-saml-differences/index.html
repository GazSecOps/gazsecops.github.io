<!doctype html><html lang=en><head><title>OAuth2 vs SAML: Which One and Why? :: Gareth's Engineering Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=" Management: We need single sign-on for our new internal app.
Sysadmin: What kind? OAuth2 or SAML?
Management: Does it matter? They both do login.
Sysadmin: One&rsquo;s for APIs and mobile apps. The other&rsquo;s for enterprise SSO. Yeah, it matters.
&#34;SAML is what enterprises use because they've used it for 20 years and it works. OAuth2 is what startups use because it's simple and modern. Neither is wrong, just different.&#34; I&rsquo;ve had this conversation too many times. Someone builds a new internal application, needs authentication, gets confused between OAuth2 and SAML. They&rsquo;re both &ldquo;login with company account&rdquo; from user&rsquo;s perspective. Underneath? Completely different protocols for different problems.
"><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://gazsecops.github.io/posts/oauth2-vs-saml-differences/><link rel=stylesheet href=https://gazsecops.github.io/css/extended.min.c658c723e006469d82f697e19c5338967fad12c57650bdd915bacf9cfbe2cc38.css><link rel=stylesheet href=https://gazsecops.github.io/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://gazsecops.github.io/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://gazsecops.github.io/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://gazsecops.github.io/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://gazsecops.github.io/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://gazsecops.github.io/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://gazsecops.github.io/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://gazsecops.github.io/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://gazsecops.github.io/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://gazsecops.github.io/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://gazsecops.github.io/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://gazsecops.github.io/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://gazsecops.github.io/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel="shortcut icon" href=https://gazsecops.github.io/favicon.png><link rel=apple-touch-icon href=https://gazsecops.github.io/apple-touch-icon.png><meta name=twitter:card content="summary"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="OAuth2 vs SAML: Which One and Why?"><meta property="og:description" content=" Management: We need single sign-on for our new internal app.
Sysadmin: What kind? OAuth2 or SAML?
Management: Does it matter? They both do login.
Sysadmin: One&rsquo;s for APIs and mobile apps. The other&rsquo;s for enterprise SSO. Yeah, it matters.
&#34;SAML is what enterprises use because they've used it for 20 years and it works. OAuth2 is what startups use because it's simple and modern. Neither is wrong, just different.&#34; I&rsquo;ve had this conversation too many times. Someone builds a new internal application, needs authentication, gets confused between OAuth2 and SAML. They&rsquo;re both &ldquo;login with company account&rdquo; from user&rsquo;s perspective. Underneath? Completely different protocols for different problems.
"><meta property="og:url" content="https://gazsecops.github.io/posts/oauth2-vs-saml-differences/"><meta property="og:site_name" content="Gareth's Engineering Blog"><meta property="og:image" content="https://gazsecops.github.io/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2025-11-10 10:00:00 +0000 UTC"></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>gareth@blog:~$</div></a></div><div class=header__search><input type=text id=header-search placeholder="Quick search..." style="padding:5px 10px;background:#222;color:#eee;border:1px solid #444;border-radius:3px;font-size:14px;width:200px"></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/topics/>Topics</a></li><li><a href=/posts/>All</a></li><li><a href=/series/>Series</a></li><li><a href=/tags/>Tags</a></li><li><a href=/archive/>Archive</a></li><li><a href=/search/>Search</a></li><li><a href=/about/>About</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/topics/>Topics</a></li><li><a href=/posts/>All</a></li><li><a href=/series/>Series</a></li><li><a href=/tags/>Tags</a></li><li><a href=/archive/>Archive</a></li><li><a href=/search/>Search</a></li><li><a href=/about/>About</a></li></ul></nav></header><script>(function(){const e=document.getElementById("header-search");if(!e)return;e.addEventListener("keydown",function(e){if(e.key==="Enter"){const e=this.value.trim();e&&(window.location.href="/search?q="+encodeURIComponent(e))}}),document.addEventListener("keydown",function(t){t.key==="/"&&!["INPUT","TEXTAREA"].includes(t.target.tagName)&&(t.preventDefault(),e.focus()),t.key==="Escape"&&t.target===e&&e.blur()})})()</script><style>.header__inner{display:flex;align-items:center;gap:20px}.header__search{flex:none}#header-search::placeholder{color:#666;font-style:italic}#header-search:focus{outline:none;border-color:#888}@media(max-width:684px){.header__search{display:none}}</style><div class=content><article class=post><h1 class=post-title><a href=https://gazsecops.github.io/posts/oauth2-vs-saml-differences/>OAuth2 vs SAML: Which One and Why?</a></h1><div class=post-meta><time class=post-date>2025-11-10</time><span class=post-author>Gareth</span><span class=post-reading-time>12 min read (2487 words)</span></div><span class=post-tags>#<a href=https://gazsecops.github.io/tags/authentication/>authentication</a>&nbsp;
#<a href=https://gazsecops.github.io/tags/oauth2/>oauth2</a>&nbsp;
#<a href=https://gazsecops.github.io/tags/saml/>saml</a>&nbsp;
#<a href=https://gazsecops.github.io/tags/security/>security</a>&nbsp;
#<a href=https://gazsecops.github.io/tags/enterprise/>enterprise</a>&nbsp;</span><div class=table-of-contents><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#the-fundamental-difference>The Fundamental Difference</a></li><li><a href=#how-oauth2-works>How OAuth2 Works</a><ul><li><a href=#the-flow>The Flow</a></li><li><a href=#the-token-structure>The Token Structure</a></li><li><a href=#code-example>Code Example</a></li><li><a href=#when-oauth2-makes-sense>When OAuth2 Makes Sense</a></li></ul></li><li><a href=#how-saml-works>How SAML Works</a><ul><li><a href=#the-flow-1>The Flow</a></li><li><a href=#the-saml-assertion>The SAML Assertion</a></li><li><a href=#code-example-1>Code Example</a></li><li><a href=#when-saml-makes-sense>When SAML Makes Sense</a></li></ul></li><li><a href=#the-openid-connect-twist>The OpenID Connect Twist</a><ul><li><a href=#oidc-id-token>OIDC ID Token</a></li><li><a href=#when-to-use-oidc>When to Use OIDC</a></li></ul></li><li><a href=#the-hybrid-setup-you-see-everywhere>The Hybrid Setup You See Everywhere</a></li><li><a href=#decision-framework>Decision Framework</a><ul><li><a href=#choose-oauth2-or-oidc-when>Choose OAuth2 (or OIDC) When:</a></li><li><a href=#choose-saml-when>Choose SAML When:</a></li><li><a href=#practical-decision-flow>Practical Decision Flow</a></li></ul></li><li><a href=#common-mistakes>Common Mistakes</a><ul><li><a href=#mistake-1-using-oauth2-for-enterprise-sso>Mistake 1: Using OAuth2 for Enterprise SSO</a></li><li><a href=#mistake-2-using-saml-for-mobile-apps>Mistake 2: Using SAML for Mobile Apps</a></li><li><a href=#mistake-3-confusing-oauth2-with-authentication>Mistake 3: Confusing OAuth2 with Authentication</a></li><li><a href=#mistake-4-implementing-saml-from-scratch>Mistake 4: Implementing SAML from Scratch</a></li></ul></li><li><a href=#integration-examples>Integration Examples</a><ul><li><a href=#example-1-internal-enterprise-web-app>Example 1: Internal Enterprise Web App</a></li><li><a href=#example-2-mobile-app-with-social-login>Example 2: Mobile App with Social Login</a></li><li><a href=#example-3-third-party-api-integration>Example 3: Third-Party API Integration</a></li><li><a href=#example-4-modern-internal-web-app-with-oidc>Example 4: Modern Internal Web App with OIDC</a></li></ul></li><li><a href=#security-considerations>Security Considerations</a><ul><li><a href=#oauth2-security>OAuth2 Security</a></li><li><a href=#saml-security>SAML Security</a></li></ul></li><li><a href=#the-honest-advice>The Honest Advice</a></li></ul></nav></div><div class=post-content><div><div class=dialogue><p><span class="speaker speaker-management">Management:</span> We need single sign-on for our new internal app.</p><p><span class="speaker speaker-sysadmin">Sysadmin:</span> What kind? OAuth2 or SAML?</p><p><span class="speaker speaker-management">Management:</span> Does it matter? They both do login.</p><p><span class="speaker speaker-sysadmin">Sysadmin:</span> One&rsquo;s for APIs and mobile apps. The other&rsquo;s for enterprise SSO. Yeah, it matters.</p></div><aside class=pullquote>"SAML is what enterprises use because they've used it for 20 years and it works. OAuth2 is what startups use because it's simple and modern. Neither is wrong, just different."</aside><p>I&rsquo;ve had this conversation too many times. Someone builds a new internal application, needs authentication, gets confused between OAuth2 and SAML. They&rsquo;re both &ldquo;login with company account&rdquo; from user&rsquo;s perspective. Underneath? Completely different protocols for different problems.</p><h2 id=the-fundamental-difference>The Fundamental Difference<a href=#the-fundamental-difference class=hanchor arialabel=Anchor>#</a></h2><p><strong>OAuth2</strong> is an <strong>authorization</strong> framework. It&rsquo;s about delegation - giving an application permission to act on your behalf.</p><p><strong>SAML</strong> is an <strong>authentication</strong> protocol. It&rsquo;s about identity - proving who you are and getting a trusted assertion.</p><p>The confusion comes because OAuth2 gets used for authentication (OpenID Connect). But at their core:</p><table><thead><tr><th>OAuth2</th><th>SAML</th></tr></thead><tbody><tr><td>Authorization (can I access this API?)</td><td>Authentication (who am I?)</td></tr><tr><td>JSON-based</td><td>XML-based</td></tr><tr><td>Tokens (access tokens, refresh tokens)</td><td>Assertions (XML assertions)</td></tr><tr><td>Modern, API-focused</td><td>Enterprise, XML-heavy</td></tr><tr><td>Simple to implement</td><td>Complex but feature-rich</td></tr></tbody></table><h2 id=how-oauth2-works>How OAuth2 Works<a href=#how-oauth2-works class=hanchor arialabel=Anchor>#</a></h2><h3 id=the-flow>The Flow<a href=#the-flow class=hanchor arialabel=Anchor>#</a></h3><p>OAuth2 defines several flows (grant types). Most common:</p><p><strong>Authorization Code Flow</strong> (for server-side apps):</p><ol><li><strong>Redirect to identity provider</strong> - Application redirects user&rsquo;s browser to IdP (Google, GitHub, etc.)</li><li><strong>User authenticates</strong> - User logs in with their credentials</li><li><strong>Authorization code</strong> - IdP redirects back to your app with a temporary code</li><li><strong>Exchange code for token</strong> - Your backend exchanges the code for an access token (and refresh token)</li><li><strong>Access API</strong> - Use access token to make requests on user&rsquo;s behalf</li></ol><p><strong>Implicit Flow</strong> (for single-page apps - now deprecated in favour of PKCE):</p><ol><li><strong>Redirect to identity provider</strong> - Application redirects user to IdP</li><li><strong>User authenticates</strong> - User logs in</li><li><strong>Access token in URL</strong> - IdP redirects back with access token directly in URL fragment</li><li><strong>Access API</strong> - Use token to make requests</li></ol><p><strong>Authorization Code Flow with PKCE</strong> (for mobile and SPAs):</p><p>Same as authorization code flow, but with a code verifier to prevent interception attacks. This is what you should use for mobile and SPAs now.</p><h3 id=the-token-structure>The Token Structure<a href=#the-token-structure class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;access_token&#34;</span>: <span style=color:#e6db74>&#34;eyJhbGciOiJIUzI1NiIs...&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;token_type&#34;</span>: <span style=color:#e6db74>&#34;Bearer&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;expires_in&#34;</span>: <span style=color:#ae81ff>3600</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;refresh_token&#34;</span>: <span style=color:#e6db74>&#34;def502ad1f8c...&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;scope&#34;</span>: <span style=color:#e6db74>&#34;read:user user:email&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Access token:</strong> Short-lived token used to access APIs
<strong>Refresh token:</strong> Long-lived token used to get new access tokens
<strong>Scope:</strong> Permissions granted to the token</p><h3 id=code-example>Code Example<a href=#code-example class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> authlib.integrations.requests_client <span style=color:#f92672>import</span> OAuth2Session
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># OAuth2 session</span>
</span></span><span style=display:flex><span>client_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;your_app_id&#34;</span>
</span></span><span style=display:flex><span>client_secret <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;your_app_secret&#34;</span>
</span></span><span style=display:flex><span>authorization_endpoint <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://github.com/login/oauth/authorize&#34;</span>
</span></span><span style=display:flex><span>token_endpoint <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://github.com/login/oauth/access_token&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 1: Redirect user to authorization endpoint</span>
</span></span><span style=display:flex><span>auth_url <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>authorization_endpoint<span style=color:#e6db74>}</span><span style=color:#e6db74>?client_id=</span><span style=color:#e6db74>{</span>client_id<span style=color:#e6db74>}</span><span style=color:#e6db74>&amp;scope=user:email&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># In real app, redirect user&#39;s browser to this URL</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 2: User authenticates at GitHub, redirected back with code</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 3: Exchange code for token</span>
</span></span><span style=display:flex><span>session <span style=color:#f92672>=</span> OAuth2Session(client_id, client_secret)
</span></span><span style=display:flex><span>token <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>fetch_token(token_endpoint, authorization_response<span style=color:#f92672>=</span>request<span style=color:#f92672>.</span>url)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 4: Use access token</span>
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;https://api.github.com/user&#34;</span>)
</span></span><span style=display:flex><span>user_data <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 5: Refresh access token if expired</span>
</span></span><span style=display:flex><span>new_token <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>refresh_token(token_endpoint, refresh_token<span style=color:#f92672>=</span>token[<span style=color:#e6db74>&#39;refresh_token&#39;</span>])
</span></span></code></pre></div><h3 id=when-oauth2-makes-sense>When OAuth2 Makes Sense<a href=#when-oauth2-makes-sense class=hanchor arialabel=Anchor>#</a></h3><p><strong>Good for:</strong></p><ul><li>Mobile applications (native apps)</li><li>Single-page applications (JavaScript in browser)</li><li>Third-party API integrations (&ldquo;Connect with Google&rdquo;)</li><li>Server-side applications needing delegated access</li><li>Modern web applications</li></ul><p><strong>Not good for:</strong></p><ul><li>Enterprise SSO with complex requirements (SAML&rsquo;s better here)</li><li>Situations requiring rich security assertions (SAML has more features)</li><li>Legacy enterprise systems that already use SAML</li></ul><h2 id=how-saml-works>How SAML Works<a href=#how-saml-works class=hanchor arialabel=Anchor>#</a></h2><h3 id=the-flow-1>The Flow<a href=#the-flow-1 class=hanchor arialabel=Anchor>#</a></h3><p>SAML uses XML assertions and a browser-based SSO flow:</p><ol><li><strong>Request access</strong> - Application (Service Provider) requests authentication from IdP</li><li><strong>Redirect to IdP</strong> - User&rsquo;s browser redirected to Identity Provider (Azure AD, Okta, etc.)</li><li><strong>User authenticates</strong> - User logs in (possibly via another SSO)</li><li><strong>SAML assertion</strong> - IdP creates XML assertion with user&rsquo;s identity and attributes</li><li><strong>Redirect back</strong> - Assertion POSTed back to application via browser</li><li><strong>Validate assertion</strong> - Application validates signature, extracts user identity</li><li><strong>Create session</strong> - Application creates local session for user</li></ol><h3 id=the-saml-assertion>The SAML Assertion<a href=#the-saml-assertion class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;samlp:Response</span> <span style=color:#a6e22e>xmlns:samlp=</span><span style=color:#e6db74>&#34;urn:oasis:names:tc:SAML:2.0:protocol&#34;</span>
</span></span><span style=display:flex><span>                 <span style=color:#a6e22e>ID=</span><span style=color:#e6db74>&#34;_8e8dc5f69a98cc4c1ff98297e343f1fc3079276f&#34;</span>
</span></span><span style=display:flex><span>                 <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;2.0&#34;</span>
</span></span><span style=display:flex><span>                 <span style=color:#a6e22e>IssueInstant=</span><span style=color:#e6db74>&#34;2025-11-10T10:00:00Z&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;saml:Issuer</span> <span style=color:#a6e22e>xmlns:saml=</span><span style=color:#e6db74>&#34;urn:oasis:names:tc:SAML:2.0:assertion&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    https://idp.example.com/saml
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/saml:Issuer&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;ds:Signature</span> <span style=color:#a6e22e>xmlns:ds=</span><span style=color:#e6db74>&#34;http://www.w3.org/2000/09/xmldsig#&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- Cryptographic signature proving this assertion is from trusted IdP --&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/ds:Signature&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;samlp:Status&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;samlp:StatusCode</span> <span style=color:#a6e22e>Value=</span><span style=color:#e6db74>&#34;urn:oasis:names:tc:SAML:2.0:status:Success&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/samlp:Status&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;saml:Assertion</span> <span style=color:#a6e22e>xmlns:saml=</span><span style=color:#e6db74>&#34;urn:oasis:names:tc:SAML:2.0:assertion&#34;</span>
</span></span><span style=display:flex><span>                 <span style=color:#a6e22e>ID=</span><span style=color:#e6db74>&#34;_b7b6da6926e49e8c1ff9213e345f2ge3079867g&#34;</span>
</span></span><span style=display:flex><span>                 <span style=color:#a6e22e>IssueInstant=</span><span style=color:#e6db74>&#34;2025-11-10T10:00:00Z&#34;</span>
</span></span><span style=display:flex><span>                 <span style=color:#a6e22e>Version=</span><span style=color:#e6db74>&#34;2.0&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;saml:Issuer&gt;</span>https://idp.example.com/saml<span style=color:#f92672>&lt;/saml:Issuer&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;ds:Signature&gt;</span>...<span style=color:#f92672>&lt;/ds:Signature&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;saml:Subject&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;saml:NameID</span> <span style=color:#a6e22e>Format=</span><span style=color:#e6db74>&#34;urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        user@example.com
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/saml:NameID&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;saml:SubjectConfirmation</span> <span style=color:#a6e22e>Method=</span><span style=color:#e6db74>&#34;urn:oasis:names:tc:SAML:2.0:cm:bearer&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;saml:SubjectConfirmationData</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>NotOnOrAfter=</span><span style=color:#e6db74>&#34;2025-11-10T10:05:00Z&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Recipient=</span><span style=color:#e6db74>&#34;https://app.example.com/saml/acs&#34;</span><span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/saml:SubjectConfirmation&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/saml:Subject&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;saml:AttributeStatement&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;saml:Attribute</span> <span style=color:#a6e22e>Name=</span><span style=color:#e6db74>&#34;email&#34;</span>
</span></span><span style=display:flex><span>                   <span style=color:#a6e22e>NameFormat=</span><span style=color:#e6db74>&#34;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;saml:AttributeValue&gt;</span>user@example.com<span style=color:#f92672>&lt;/saml:AttributeValue&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/saml:Attribute&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;saml:Attribute</span> <span style=color:#a6e22e>Name=</span><span style=color:#e6db74>&#34;firstName&#34;</span>
</span></span><span style=display:flex><span>                   <span style=color:#a6e22e>NameFormat=</span><span style=color:#e6db74>&#34;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;saml:AttributeValue&gt;</span>John<span style=color:#f92672>&lt;/saml:AttributeValue&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/saml:Attribute&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;saml:Attribute</span> <span style=color:#a6e22e>Name=</span><span style=color:#e6db74>&#34;lastName&#34;</span>
</span></span><span style=display:flex><span>                   <span style=color:#a6e22e>NameFormat=</span><span style=color:#e6db74>&#34;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;saml:AttributeValue&gt;</span>Doe<span style=color:#f92672>&lt;/saml:AttributeValue&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/saml:Attribute&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;saml:Attribute</span> <span style=color:#a6e22e>Name=</span><span style=color:#e6db74>&#34;groups&#34;</span>
</span></span><span style=display:flex><span>                   <span style=color:#a6e22e>NameFormat=</span><span style=color:#e6db74>&#34;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;saml:AttributeValue&gt;</span>Engineering<span style=color:#f92672>&lt;/saml:AttributeValue&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;saml:AttributeValue&gt;</span>Admin<span style=color:#f92672>&lt;/saml:AttributeValue&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/saml:Attribute&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/saml:AttributeStatement&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;saml:AuthnStatement</span> <span style=color:#a6e22e>AuthnInstant=</span><span style=color:#e6db74>&#34;2025-11-10T10:00:00Z&#34;</span>
</span></span><span style=display:flex><span>                     <span style=color:#a6e22e>SessionIndex=</span><span style=color:#e6db74>&#34;_8e8dc5f69a98cc4c1ff98297e343f1fc3079276f&#34;</span>
</span></span><span style=display:flex><span>                     <span style=color:#a6e22e>SessionNotOnOrAfter=</span><span style=color:#e6db74>&#34;2025-11-10T11:00:00Z&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;saml:AuthnContext&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;saml:AuthnContextClassRef&gt;</span>
</span></span><span style=display:flex><span>          urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/saml:AuthnContextClassRef&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/saml:AuthnContext&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/saml:AuthnStatement&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/saml:Assertion&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/samlp:Response&gt;</span>
</span></span></code></pre></div><p>This XML assertion contains:</p><ul><li>User&rsquo;s identity (NameID, email, name)</li><li>User attributes (groups, department, etc.)</li><li>Authentication details (when they logged in, how)</li><li>Digital signature (proves it&rsquo;s from trusted IdP)</li></ul><h3 id=code-example-1>Code Example<a href=#code-example-1 class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> saml2 <span style=color:#f92672>import</span> BINDING_HTTP_POST
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> saml2.client <span style=color:#f92672>import</span> Saml2Client
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> saml2.config <span style=color:#f92672>import</span> Config <span style=color:#66d9ef>as</span> Saml2Config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># SAML configuration</span>
</span></span><span style=display:flex><span>saml_config <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;entityid&#39;</span>: <span style=color:#e6db74>&#39;https://app.example.com/saml&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;metadata&#39;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;remote&#39;</span>: [{
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;entityid&#39;</span>: <span style=color:#e6db74>&#39;https://idp.example.com/saml&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;metadata&#39;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;url&#39;</span>: <span style=color:#e6db74>&#39;https://idp.example.com/saml/metadata.xml&#39;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }]
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;service&#39;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;sp&#39;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;endpoints&#39;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;assertion_consumer_service&#39;</span>: [
</span></span><span style=display:flex><span>                    (<span style=color:#e6db74>&#39;https://app.example.com/saml/acs&#39;</span>, BINDING_HTTP_POST),
</span></span><span style=display:flex><span>                ],
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;allow_unsolicited&#39;</span>: <span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;authn_requests_signed&#39;</span>: <span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;logout_requests_signed&#39;</span>: <span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;want_assertions_signed&#39;</span>: <span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;want_assertions_encrypted&#39;</span>: <span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;want_name_id_encrypted&#39;</span>: <span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create SAML client</span>
</span></span><span style=display:flex><span>config <span style=color:#f92672>=</span> Saml2Config()
</span></span><span style=display:flex><span>config<span style=color:#f92672>.</span>load(saml_config)
</span></span><span style=display:flex><span>saml_client <span style=color:#f92672>=</span> Saml2Client(config)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 1: Create SAML auth request</span>
</span></span><span style=display:flex><span>req_id, authn_request <span style=color:#f92672>=</span> saml_client<span style=color:#f92672>.</span>create_authn_request(
</span></span><span style=display:flex><span>    entity_id<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;https://idp.example.com/saml&#39;</span>,
</span></span><span style=display:flex><span>    sign<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 2: Redirect user to IdP</span>
</span></span><span style=display:flex><span>auth_url <span style=color:#f92672>=</span> saml_client<span style=color:#f92672>.</span>apply_binding(
</span></span><span style=display:flex><span>    BINDING_HTTP_POST,
</span></span><span style=display:flex><span>    authn_request,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;https://idp.example.com/saml/sso&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#75715e># In real app, redirect user&#39;s browser to this URL</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 3: User authenticates, IdP POSTs SAML assertion back</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 4: Parse and validate assertion</span>
</span></span><span style=display:flex><span>authn_response <span style=color:#f92672>=</span> saml_client<span style=color:#f92672>.</span>parse_authn_request_response(
</span></span><span style=display:flex><span>    saml_request_xml_from_post_body,
</span></span><span style=display:flex><span>    BINDING_HTTP_POST
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 5: Validate assertion</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> authn_response<span style=color:#f92672>.</span>get_identity():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>Exception</span>(<span style=color:#e6db74>&#34;Invalid SAML response&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 6: Extract user data</span>
</span></span><span style=display:flex><span>user_data <span style=color:#f92672>=</span> authn_response<span style=color:#f92672>.</span>get_identity()
</span></span><span style=display:flex><span>email <span style=color:#f92672>=</span> user_data[<span style=color:#e6db74>&#39;email&#39;</span>]
</span></span><span style=display:flex><span>name <span style=color:#f92672>=</span> user_data[<span style=color:#e6db74>&#39;firstName&#39;</span>]
</span></span><span style=display:flex><span>groups <span style=color:#f92672>=</span> user_data[<span style=color:#e6db74>&#39;groups&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Step 7: Create local session</span>
</span></span><span style=display:flex><span>create_session(email, name, groups)
</span></span></code></pre></div><h3 id=when-saml-makes-sense>When SAML Makes Sense<a href=#when-saml-makes-sense class=hanchor arialabel=Anchor>#</a></h3><p><strong>Good for:</strong></p><ul><li>Enterprise single sign-on (SSO)</li><li>Applications needing rich user attributes (groups, department, roles)</li><li>Compliance-heavy environments (government, finance, healthcare)</li><li>Integration with existing enterprise identity providers (Azure AD, Okta, Ping)</li><li>Situations requiring strong security assertions (encrypted assertions, signed responses)</li></ul><p><strong>Not good for:</strong></p><ul><li>Mobile applications (browser-based SSO doesn&rsquo;t work well)</li><li>Third-party API integrations (OAuth2 is designed for this)</li><li>Simple use cases (OAuth2 is easier)</li><li>Modern startups without existing SAML infrastructure</li></ul><h2 id=the-openid-connect-twist>The OpenID Connect Twist<a href=#the-openid-connect-twist class=hanchor arialabel=Anchor>#</a></h2><p>Here&rsquo;s where it gets confusing. <strong>OpenID Connect (OIDC)</strong> is built on top of OAuth2 but adds authentication.</p><p><strong>OAuth2:</strong> Authorization (can I access this API?)
<strong>OIDC:</strong> Authentication (who am I?)</p><p>OIDC adds to OAuth2:</p><ul><li>Standardized ID token (JWT with user identity)</li><li>Standardized userinfo endpoint</li><li>Discovery endpoint (find endpoints automatically)</li><li>Registration endpoint (dynamic client registration)</li></ul><h3 id=oidc-id-token>OIDC ID Token<a href=#oidc-id-token class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;iss&#34;</span>: <span style=color:#e6db74>&#34;https://idp.example.com&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;sub&#34;</span>: <span style=color:#e6db74>&#34;1234567890&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;aud&#34;</span>: <span style=color:#e6db74>&#34;your_client_id&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;exp&#34;</span>: <span style=color:#ae81ff>1699999999</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;iat&#34;</span>: <span style=color:#ae81ff>1699909999</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;John Doe&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;email&#34;</span>: <span style=color:#e6db74>&#34;user@example.com&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;groups&#34;</span>: [<span style=color:#e6db74>&#34;Engineering&#34;</span>, <span style=color:#e6db74>&#34;Admin&#34;</span>]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This is a JWT (JSON Web Token) - signed, verifiable, contains user identity.</p><h3 id=when-to-use-oidc>When to Use OIDC<a href=#when-to-use-oidc class=hanchor arialabel=Anchor>#</a></h3><p>Use OIDC when:</p><ul><li>You want OAuth2 simplicity but need authentication</li><li>You&rsquo;re building modern web applications</li><li>You need standardized user identity format</li><li>You want to avoid XML complexity of SAML</li></ul><p>Many modern IdPs (Azure AD, Auth0, Okta) support both SAML and OIDC.</p><h2 id=the-hybrid-setup-you-see-everywhere>The Hybrid Setup You See Everywhere<a href=#the-hybrid-setup-you-see-everywhere class=hanchor arialabel=Anchor>#</a></h2><p>Most organisations don&rsquo;t pick one protocol and live happily ever after. They end up with a hybrid.</p><p>Typical enterprise pattern:</p><ol><li>Browser SSO into the web app using SAML (because the enterprise IdP and group/attribute mapping is already there)</li><li>Web app creates a session (cookie)</li><li>Web app calls internal APIs using OAuth2 access tokens (service-to-service, or on behalf of the user)</li></ol><p>Why this happens:</p><ul><li>SAML is good at browser SSO and shoving attributes/groups into an assertion</li><li>OAuth2 is good at API calls and scoped tokens</li></ul><p>What breaks if you get this wrong:</p><ul><li>You treat a SAML login as permission to call every API forever</li><li>You mint an internal &ldquo;god token&rdquo; because it&rsquo;s easier than scoping</li><li>You never re-check group membership, so leavers keep access via long-lived sessions</li></ul><p>If you do hybrid, be explicit about the boundary:</p><ul><li>SAML/OIDC gets the user into the app</li><li>OAuth2 tokens control what the app can do to downstream services</li></ul><h2 id=decision-framework>Decision Framework<a href=#decision-framework class=hanchor arialabel=Anchor>#</a></h2><h3 id=choose-oauth2-or-oidc-when>Choose OAuth2 (or OIDC) When:<a href=#choose-oauth2-or-oidc-when class=hanchor arialabel=Anchor>#</a></h3><p><strong>Your application is:</strong></p><ul><li>Mobile app (iOS, Android)</li><li>Single-page application (React, Angular, Vue)</li><li>API-focused (REST, GraphQL)</li><li>Third-party integration (&ldquo;Connect with X&rdquo;)</li><li>Modern web application without enterprise SSO requirements</li></ul><p><strong>You need:</strong></p><ul><li>Simple implementation</li><li>Token-based API access</li><li>Delegated permissions (app acts on user&rsquo;s behalf)</li><li>Modern development experience</li><li>JSON-based data exchange</li></ul><p><strong>Examples:</strong></p><ul><li>Mobile app accessing social media API</li><li>SPAs needing user login with Google</li><li>B2B application integrating with partner&rsquo;s APIs</li><li>Internal tool using GitHub or GitLab for login</li></ul><h3 id=choose-saml-when>Choose SAML When:<a href=#choose-saml-when class=hanchor arialabel=Anchor>#</a></h3><p><strong>Your application is:</strong></p><ul><li>Enterprise web application</li><li>Internal business application</li><li>Application requiring compliance (SOC2, HIPAA, PCI-DSS)</li><li>Part of existing enterprise SSO ecosystem</li></ul><p><strong>You need:</strong></p><ul><li>Rich user attributes (groups, department, org hierarchy)</li><li>Enterprise SSO integration (Azure AD, Okta, Ping)</li><li>Strong security assertions (signed, encrypted responses)</li><li>Federation standards</li><li>Integration with legacy enterprise systems</li></ul><p><strong>Examples:</strong></p><ul><li>HR management system</li><li>Finance application requiring department-level access</li><li>Internal dashboard for employees</li><li>Application deployed to enterprise environment with existing IdP</li></ul><h3 id=practical-decision-flow>Practical Decision Flow<a href=#practical-decision-flow class=hanchor arialabel=Anchor>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>Start
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>├─</span> Does this need to integrate with enterprise SSO (Azure AD, Okta)<span style=color:#960050;background-color:#1e0010>?</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>   <span style=color:#960050;background-color:#1e0010>├─</span> Yes <span style=color:#960050;background-color:#1e0010>→</span> Use SAML (<span style=color:#f92672>or</span> OIDC <span style=color:#66d9ef>if</span> IdP supports it)
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>   <span style=color:#960050;background-color:#1e0010>└─</span> No <span style=color:#960050;background-color:#1e0010>→</span> Continue
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>├─</span> Is this a mobile app <span style=color:#f92672>or</span> SPA<span style=color:#960050;background-color:#1e0010>?</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>   <span style=color:#960050;background-color:#1e0010>├─</span> Yes <span style=color:#960050;background-color:#1e0010>→</span> Use OAuth2 (<span style=color:#f92672>or</span> OIDC)
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>   <span style=color:#960050;background-color:#1e0010>└─</span> No <span style=color:#960050;background-color:#1e0010>→</span> Continue
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>├─</span> Is this <span style=color:#66d9ef>for</span> third<span style=color:#f92672>-</span>party API access<span style=color:#960050;background-color:#1e0010>?</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>   <span style=color:#960050;background-color:#1e0010>├─</span> Yes <span style=color:#960050;background-color:#1e0010>→</span> Use OAuth2
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>   <span style=color:#960050;background-color:#1e0010>└─</span> No <span style=color:#960050;background-color:#1e0010>→</span> Continue
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>├─</span> Do you need rich user attributes (groups, department)<span style=color:#960050;background-color:#1e0010>?</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>   <span style=color:#960050;background-color:#1e0010>├─</span> Yes <span style=color:#960050;background-color:#1e0010>→</span> Use SAML
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>   <span style=color:#960050;background-color:#1e0010>└─</span> No <span style=color:#960050;background-color:#1e0010>→</span> Use OAuth2<span style=color:#f92672>/</span>OIDC
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>│</span>
</span></span><span style=display:flex><span>  <span style=color:#960050;background-color:#1e0010>└─</span> Are you a modern startup without legacy constraints<span style=color:#960050;background-color:#1e0010>?</span>
</span></span><span style=display:flex><span>      <span style=color:#960050;background-color:#1e0010>├─</span> Yes <span style=color:#960050;background-color:#1e0010>→</span> Use OAuth2<span style=color:#f92672>/</span>OIDC (simpler, more modern)
</span></span><span style=display:flex><span>      <span style=color:#960050;background-color:#1e0010>└─</span> No <span style=color:#960050;background-color:#1e0010>→</span> Use SAML (fits enterprise ecosystem)
</span></span></code></pre></div><h2 id=common-mistakes>Common Mistakes<a href=#common-mistakes class=hanchor arialabel=Anchor>#</a></h2><h3 id=mistake-1-using-oauth2-for-enterprise-sso>Mistake 1: Using OAuth2 for Enterprise SSO<a href=#mistake-1-using-oauth2-for-enterprise-sso class=hanchor arialabel=Anchor>#</a></h3><p>OAuth2 can do authentication (via OIDC), but enterprise features are limited.</p><p><strong>Problems:</strong></p><ul><li>OIDC doesn&rsquo;t have SAML&rsquo;s rich attribute capabilities</li><li>Enterprise IdPs sometimes don&rsquo;t support OIDC fully</li><li>Missing enterprise-specific features (fine-grained access control, complex attribute mapping)</li></ul><p><strong>Better:</strong> Use SAML for enterprise SSO. Use OAuth2 for APIs and third-party integrations.</p><h3 id=mistake-2-using-saml-for-mobile-apps>Mistake 2: Using SAML for Mobile Apps<a href=#mistake-2-using-saml-for-mobile-apps class=hanchor arialabel=Anchor>#</a></h3><p>SAML is browser-based. Doesn&rsquo;t work well for mobile apps.</p><p><strong>Problems:</strong></p><ul><li>Requires embedded browser (bad UX)</li><li>Complex XML parsing on mobile devices</li><li>Not designed for mobile-first flows</li></ul><p><strong>Better:</strong> Use OAuth2 with PKCE for mobile apps.</p><h3 id=mistake-3-confusing-oauth2-with-authentication>Mistake 3: Confusing OAuth2 with Authentication<a href=#mistake-3-confusing-oauth2-with-authentication class=hanchor arialabel=Anchor>#</a></h3><p>OAuth2 is authorization. Using it for authentication directly is reinventing the wheel.</p><p><strong>Problems:</strong></p><ul><li>No standardized user identity format</li><li>Every provider does it differently</li><li>Security vulnerabilities if done incorrectly</li></ul><p><strong>Better:</strong> Use OpenID Connect (OIDC) - it&rsquo;s OAuth2 done right for authentication.</p><h3 id=mistake-4-implementing-saml-from-scratch>Mistake 4: Implementing SAML from Scratch<a href=#mistake-4-implementing-saml-from-scratch class=hanchor arialabel=Anchor>#</a></h3><p>SAML is complex. Implementing it from scratch is painful.</p><p><strong>Problems:</strong></p><ul><li>XML parsing and signing is error-prone</li><li>Security vulnerabilities in custom implementations</li><li>Time-consuming to get right</li></ul><p><strong>Better:</strong> Use a library (saml2 in Python, node-saml in Node.js, etc.) or a service like Auth0 or Okta.</p><h2 id=integration-examples>Integration Examples<a href=#integration-examples class=hanchor arialabel=Anchor>#</a></h2><h3 id=example-1-internal-enterprise-web-app>Example 1: Internal Enterprise Web App<a href=#example-1-internal-enterprise-web-app class=hanchor arialabel=Anchor>#</a></h3><p><strong>Scenario:</strong> HR management system deployed to enterprise environment using Azure AD.</p><p><strong>Solution:</strong> Use SAML.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Configure SAML with Azure AD metadata</span>
</span></span><span style=display:flex><span>saml_config <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;entityid&#39;</span>: <span style=color:#e6db74>&#39;https://hr-app.company.com/saml&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;metadata&#39;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;remote&#39;</span>: [{
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;entityid&#39;</span>: <span style=color:#e6db74>&#39;https://sts.windows.net/company-id/&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;metadata&#39;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#39;url&#39;</span>: <span style=color:#e6db74>&#39;https://sts.windows.net/company-id/federationmetadata/2007-06/federationmetadata.xml&#39;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }]
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#75715e># ... rest of config</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># User redirected to Azure AD login</span>
</span></span><span style=display:flex><span><span style=color:#75715e># SAML assertion returned with user&#39;s groups, department, manager</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create local session with appropriate permissions</span>
</span></span></code></pre></div><h3 id=example-2-mobile-app-with-social-login>Example 2: Mobile App with Social Login<a href=#example-2-mobile-app-with-social-login class=hanchor arialabel=Anchor>#</a></h3><p><strong>Scenario:</strong> Fitness app allowing login with Google, Facebook, Apple.</p><p><strong>Solution:</strong> Use OAuth2 (Authorization Code Flow with PKCE).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># OAuth2 configuration for each provider</span>
</span></span><span style=display:flex><span>providers <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;google&#39;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;authorization_endpoint&#39;</span>: <span style=color:#e6db74>&#39;https://accounts.google.com/o/oauth2/v2/auth&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;token_endpoint&#39;</span>: <span style=color:#e6db74>&#39;https://oauth2.googleapis.com/token&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;scope&#39;</span>: <span style=color:#e6db74>&#39;email profile&#39;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;facebook&#39;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;authorization_endpoint&#39;</span>: <span style=color:#e6db74>&#39;https://www.facebook.com/v18.0/dialog/oauth&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;token_endpoint&#39;</span>: <span style=color:#e6db74>&#39;https://graph.facebook.com/v18.0/oauth/access_token&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;scope&#39;</span>: <span style=color:#e6db74>&#39;email&#39;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># User selects provider, redirected to login</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Exchange code for token (with PKCE verifier)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Use access token to fetch user profile</span>
</span></span></code></pre></div><h3 id=example-3-third-party-api-integration>Example 3: Third-Party API Integration<a href=#example-3-third-party-api-integration class=hanchor arialabel=Anchor>#</a></h3><p><strong>Scenario:</strong> E-commerce platform needs to access customer&rsquo;s Shopify store data.</p><p><strong>Solution:</strong> Use OAuth2 (Authorization Code Flow).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># OAuth2 with Shopify</span>
</span></span><span style=display:flex><span>client_id <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;your_app_id&#34;</span>
</span></span><span style=display:flex><span>client_secret <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;your_app_secret&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Redirect user to Shopify install URL</span>
</span></span><span style=display:flex><span>install_url <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;https://</span><span style=color:#e6db74>{</span>shop_domain<span style=color:#e6db74>}</span><span style=color:#e6db74>/admin/oauth/authorize?client_id=</span><span style=color:#e6db74>{</span>client_id<span style=color:#e6db74>}</span><span style=color:#e6db74>&amp;scope=read_products,read_orders&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># User approves, returns code</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Exchange code for access token</span>
</span></span><span style=display:flex><span>token <span style=color:#f92672>=</span> exchange_code_for_token(install_url, client_secret)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Use access token to call Shopify API</span>
</span></span><span style=display:flex><span>products <span style=color:#f92672>=</span> get_products_from_shopify(token[<span style=color:#e6db74>&#39;access_token&#39;</span>])
</span></span></code></pre></div><h3 id=example-4-modern-internal-web-app-with-oidc>Example 4: Modern Internal Web App with OIDC<a href=#example-4-modern-internal-web-app-with-oidc class=hanchor arialabel=Anchor>#</a></h3><p><strong>Scenario:</strong> Internal dashboard for tech startup using Auth0.</p><p><strong>Solution:</strong> Use OpenID Connect (OIDC).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> authlib.integrations.requests_client <span style=color:#f92672>import</span> OAuth2Session
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># OIDC configuration</span>
</span></span><span style=display:flex><span>issuer <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://company.auth0.com&#34;</span>
</span></span><span style=display:flex><span>config_url <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>issuer<span style=color:#e6db74>}</span><span style=color:#e6db74>/.well-known/openid-configuration&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Fetch OIDC configuration dynamically</span>
</span></span><span style=display:flex><span>session <span style=color:#f92672>=</span> OAuth2Session(client_id, client_secret)
</span></span><span style=display:flex><span>config <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>get(config_url)<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Build authorization URL from OIDC config</span>
</span></span><span style=display:flex><span>auth_url <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{</span>config[<span style=color:#e6db74>&#39;authorization_endpoint&#39;</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;?client_id=</span><span style=color:#e6db74>{</span>client_id<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&amp;response_type=code&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&amp;scope=openid profile email&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;&amp;redirect_uri=</span><span style=color:#e6db74>{</span>redirect_uri<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># User authenticates, returns code</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Exchange for tokens</span>
</span></span><span style=display:flex><span>tokens <span style=color:#f92672>=</span> session<span style=color:#f92672>.</span>fetch_token(
</span></span><span style=display:flex><span>    config[<span style=color:#e6db74>&#39;token_endpoint&#39;</span>],
</span></span><span style=display:flex><span>    authorization_response<span style=color:#f92672>=</span>request<span style=color:#f92672>.</span>url,
</span></span><span style=display:flex><span>    client_secret<span style=color:#f92672>=</span>client_secret
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ID token contains user identity (JWT)</span>
</span></span><span style=display:flex><span>id_token <span style=color:#f92672>=</span> tokens[<span style=color:#e6db74>&#39;id_token&#39;</span>]
</span></span><span style=display:flex><span>user_info <span style=color:#f92672>=</span> decode_jwt(id_token)
</span></span></code></pre></div><h2 id=security-considerations>Security Considerations<a href=#security-considerations class=hanchor arialabel=Anchor>#</a></h2><h3 id=oauth2-security>OAuth2 Security<a href=#oauth2-security class=hanchor arialabel=Anchor>#</a></h3><p><strong>Common vulnerabilities:</strong></p><ul><li><strong>Implicit flow without PKCE:</strong> Access tokens exposed in URL fragment</li><li><strong>CSRF attacks:</strong> No state parameter to verify request</li><li><strong>Token leakage:</strong> Tokens stored insecurely or exposed in logs</li><li><strong>Insufficient scope validation:</strong> App requests more permissions than needed</li></ul><p><strong>Best practices:</strong></p><ul><li>Use Authorization Code Flow with PKCE for mobile/SPAs</li><li>Always use HTTPS (never HTTP)</li><li>Implement state parameter to prevent CSRF</li><li>Validate scopes on every token</li><li>Store tokens securely (httpOnly cookies, secure storage on mobile)</li><li>Implement token revocation</li><li>Use short-lived access tokens with refresh tokens</li></ul><p>If you&rsquo;re using OIDC for login, add this to your checklist:</p><ul><li>Validate the ID token signature via JWKS</li><li>Check <code>iss</code>, <code>aud</code>, and <code>exp</code></li><li>Use a <code>nonce</code> and verify it (stops replay)</li></ul><p>If you don&rsquo;t validate ID tokens properly, you&rsquo;ve built &ldquo;log in with random JWT&rdquo;.</p><h3 id=saml-security>SAML Security<a href=#saml-security class=hanchor arialabel=Anchor>#</a></h3><p><strong>Common vulnerabilities:</strong></p><ul><li><strong>XML Signature bypass:</strong> Insecure XML signature validation</li><li><strong>XML External Entity (XXE):</strong> XML processing vulnerabilities</li><li><strong>Replay attacks:</strong> Reusing captured assertions</li><li><strong>Man-in-the-middle:</strong> Unencrypted assertions over HTTP</li></ul><p><strong>Best practices:</strong></p><ul><li>Always validate XML signatures</li><li>Use secure XML parsers (disable XXE)</li><li>Implement assertion expiration and validity checks</li><li>Use HTTPS only</li><li>Validate assertion recipient matches your service URL</li><li>Validate assertion issuer matches your IdP</li><li>Implement proper logout (single logout)</li></ul><p>Two practical rules that save you from the classic SAML failures:</p><ul><li>Validate the signature on what you actually consume. If your library parses one assertion but verifies a different signature, you&rsquo;re in trouble.</li><li>Validate <code>AudienceRestriction</code> and <code>Recipient</code>. If the assertion isn&rsquo;t for your SP entity ID and your ACS endpoint, reject it.</li></ul><h2 id=the-honest-advice>The Honest Advice<a href=#the-honest-advice class=hanchor arialabel=Anchor>#</a></h2><p><strong>If you&rsquo;re a startup or modern web app:</strong></p><ul><li>Use OAuth2 with OpenID Connect</li><li>Implement Authorization Code Flow with PKCE for mobile/SPAs</li><li>It&rsquo;s simpler, well-documented, widely supported</li><li>Don&rsquo;t touch SAML unless you absolutely have to</li></ul><p><strong>If you&rsquo;re enterprise:</strong></p><ul><li>Use SAML for enterprise SSO</li><li>It integrates with your existing Azure AD, Okta, Ping</li><li>Rich attribute support and compliance features out of box</li><li>Don&rsquo;t try to use OAuth2 for complex enterprise requirements</li></ul><p><strong>If you&rsquo;re doing third-party integrations:</strong></p><ul><li>Use OAuth2 (that&rsquo;s what it&rsquo;s designed for)</li><li>Implement proper token storage and refresh</li><li>Validate scopes and permissions carefully</li><li>Document integration for other developers</li></ul><p><strong>If you&rsquo;re confused:</strong></p><ul><li>Start with OAuth2/OIDC (it&rsquo;s simpler)</li><li>Switch to SAML only when enterprise requirements force you</li><li>Don&rsquo;t implement authentication from scratch - use a library or service</li></ul><hr><p><em>Lessons from implementing both in environments ranging from startups with Auth0 to enterprises with Azure AD and custom SAML. Both work. They solve different problems. Pick the right one for your situation.</em></p></div></div><div class=related-posts style="margin-top:3rem;padding-top:2rem;border-top:1px solid #333"><h3>Related Posts</h3><ul style=list-style:none;padding:0><li style=margin-bottom:1rem><a href=https://gazsecops.github.io/posts/oauth2-security-pitfalls/>OAuth 2.0 Security: What Actually Breaks</a>
<span style=color:#999;font-size:.9rem>- 20 May 2025</span><div style=font-size:.85rem;color:#666;margin-top:.25rem><span style=margin-right:.5rem>#security</span>
<span style=margin-right:.5rem>#oauth2</span>
<span style=margin-right:.5rem>#authentication</span>
<span style=margin-right:.5rem>#web-security</span></div></li><li style=margin-bottom:1rem><a href=https://gazsecops.github.io/posts/oauth2-obo-flow-complete-guide/>OAuth2 On-Behalf-Of Flow: A Complete Guide for Microservices</a>
<span style=color:#999;font-size:.9rem>- 4 Feb 2026</span><div style=font-size:.85rem;color:#666;margin-top:.25rem><span style=margin-right:.5rem>#oauth2</span>
<span style=margin-right:.5rem>#security</span>
<span style=margin-right:.5rem>#microservices</span>
<span style=margin-right:.5rem>#authentication</span>
<span style=margin-right:.5rem>#authorization</span></div></li><li style=margin-bottom:1rem><a href=https://gazsecops.github.io/posts/security-as-code-beyond-scanning/>Beyond Scanning: What Security as Code Really Means</a>
<span style=color:#999;font-size:.9rem>- 22 Nov 2025</span><div style=font-size:.85rem;color:#666;margin-top:.25rem><span style=margin-right:.5rem>#security</span>
<span style=margin-right:.5rem>#devsecops</span>
<span style=margin-right:.5rem>#automation</span>
<span style=margin-right:.5rem>#culture</span>
<span style=margin-right:.5rem>#operations</span></div></li><li style=margin-bottom:1rem><a href=https://gazsecops.github.io/posts/penetration-testing-what-works/>Penetration Testing: What Actually Works vs What You Usually Get</a>
<span style=color:#999;font-size:.9rem>- 20 Nov 2025</span><div style=font-size:.85rem;color:#666;margin-top:.25rem><span style=margin-right:.5rem>#security</span>
<span style=margin-right:.5rem>#penetration-testing</span>
<span style=margin-right:.5rem>#red-team</span>
<span style=margin-right:.5rem>#operations</span>
<span style=margin-right:.5rem>#assessment</span></div></li><li style=margin-bottom:1rem><a href=https://gazsecops.github.io/posts/supply-chain-attacks-how-they-happen/>Supply Chain Attacks: How They Happen and What Actually Works to Stop Them</a>
<span style=color:#999;font-size:.9rem>- 10 Nov 2025</span><div style=font-size:.85rem;color:#666;margin-top:.25rem><span style=margin-right:.5rem>#security</span>
<span style=margin-right:.5rem>#supply-chain</span>
<span style=margin-right:.5rem>#dependencies</span>
<span style=margin-right:.5rem>#vulnerabilities</span></div></li></ul></div><div class=pagination><div class=pagination__title><span class=pagination__title-h></span><hr></div><div class=pagination__buttons><a href=https://gazsecops.github.io/posts/supply-chain-attacks-how-they-happen/ class="button inline prev">&lt; [<span class=button__text>Supply Chain Attacks: How They Happen and What Actually Works to Stop Them</span>]
</a>::
<a href=https://gazsecops.github.io/posts/stepca-running-internal-pki/ class="button inline next">[<span class=button__text>Smallstep step-ca: Running Internal PKI Without Losing Your Mind</span>] ></a></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2026</span></div><div class=build-info><span class=build-commit>e733073</span><span class=build-date>2026-02-12 12:33 UTC</span></div></div></footer></div></body></html>